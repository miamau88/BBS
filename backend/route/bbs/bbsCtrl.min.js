const mysql=require("mysql2/promise"),db=require("./../../config.js"),view={list:(req,res)=>{res.render("bbsList.ejs",{id:1}),console.log(req.session.userid)}},process={getList:async(req,res)=>{try{const conn=await mysql.createConnection(db),param=[req.session.userid],query="SELECT no,title,regdate,msg,name As member FROM bbs left join user On bbs.member = user.idx where user.idx=?",[rows]=await conn.query(query,param);res.send(rows)}catch(err){console.log(err)}},delBody:async(req,res)=>{try{const id=req.body.no,conn=await mysql.createConnection(db),query="delete from bbs where no=?",param=[id],[rows]=await conn.query(query,param);res.send(rows)}catch(err){console.log(err)}},postInsert:async(req,res)=>{try{const{title:title,member:member,msg:msg}=req.body,conn=await mysql.createConnection(db),query="insert into bbs (title,member,msg) value(?,?,?)",param=[title,member,msg],[rows]=await conn.query(query,param),query2="SELECT no,title,regdate,msg,name as member FROM bbs join user on bbs.member = user.idx order by no desc limit 1",[rows2]=await conn.query(query2);res.send(rows2[0])}catch(err){console.log(err)}},modiPatch:async(req,res)=>{try{const{no:no,title:title,msg:msg}=req.body,conn=await mysql.createConnection(db),query="update bbs set title=?,msg=? where no=? ",param=[title,msg,no],[rows]=await conn.queyr(query,param);res.send(rows)}catch(err){console.log(err)}}};module.exports={view:view,process:process};