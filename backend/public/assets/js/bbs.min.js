let bbs=[];fetch("http://localhost:5000/bbs").then(res=>res.json()).then(res=>{bbs=res,list(),delFunc(),modiFunc()});const list=()=>{const ul=document.querySelector("ul"),bbsMap=bbslist=>(console.log(bbs),`<li data-id='${bbslist.no}'> \n        <div class=num>${bbslist.no}</div>\n        <div class=title>${bbslist.title}</div>\n        <div class=date>${dateFormat(bbslist.regdate)}</div>\n        <div class=member>${bbslist.member} \n        <button class="btnModi">수정</button>\n        <button class="btndel"> 삭제</button>\n        </div>\n        </li> `);ul.innerHTML=bbs.map(bbsMap).join("")};function dateFormat(date){const res=date.split(":");return`${res[0]}:${res[1]}`}function delFunc(){const btnDel=document.querySelectorAll(".btndel");for(let i=0;i<btnDel.length;i++)btnDel[i].addEventListener("click",e=>{const id=e.target.parentNode.parentNode.dataset.id;console.log(id),fetch("http://localhost:5000/bbs",{method:"DELETE",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({no:id})}).then(()=>{bbs.splice(i,1),e.target.parentNode.parentNode.remove(),console.log(bbs)}).catch(err=>alert(err))})}const num=document.querySelector(".modal  .num"),title=document.querySelector(".modal  #title-Input"),date=document.querySelector(".modal  .date"),member=document.querySelector(".modal .member"),txtarea=document.querySelector(".modal #modi-txtarea"),modiBtn=document.querySelector(".modal .modiBtn");function modiFunc(){const btnModiPopup=document.querySelectorAll(".btnModi");for(let i=0;i<btnModiPopup.length;i++)btnModiPopup[i].addEventListener("click",e=>{modalOpen("edit");const id=e.target.closest("li").dataset.id,res=bbs.find(v=>v.no==id);console.log(res),num.innerText=res.no,title.value=res.title,date.innerText=res.regdate,member.innerText=res.member,txtarea.innerText=res.msg});function reload(){(location||window.location||document.location).reload()}function delay(ms){return setTimeout(()=>{reload()},ms)}modiBtn.addEventListener("click",()=>{fetch("http://localhost:5000/bbs",{method:"PATCH",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({no:num.innerText,title:title.value,msg:txtarea.value})}).then(res=>res.json()).then(res=>modalCloseNone(),delay(50)).catch(err=>alert(err))})}const modal=document.querySelector(".modal"),btnOpenPopup=document.querySelector(".modalOpen"),modalClose=document.querySelector(".modal-closeX");function modalOpen(type){if(modal.style.display="block","edit"==type){const wrtBtn=document.querySelector(".wrtbtn");wrtBtn.style.display="none";const modiBtn=document.querySelector(".modiBtnBox");modiBtn.style.display="block"}if("add"==type){const modiBtn=document.querySelector(".modiBtnBox");modiBtn.style.display="none";const wrtBtn=document.querySelector(".wrtbtn");wrtBtn.style.display="block"}}function modalCloseNone(){modal.style.display="none"}btnOpenPopup.addEventListener("click",()=>{modalOpen("add"),title.value="",txtarea.value="",num.innerText="",date.innerText=""}),modalClose.addEventListener("click",modalCloseNone);const writeBtn=document.querySelector(".writeBtn"),input=document.querySelector("input");writeBtn.addEventListener("click",()=>{const member="test41231312",txtarea=document.querySelector("#modi-txtarea");fetch("http://localhost:5000/bbs",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({title:input.value,member:member,msg:txtarea.value})}).then(res=>res.json()).then(res=>{console.log(res),bbs.push({no:res.no,title:res.title,regdate:res.regdate,member:res.member,msg:res.msg}),list(),modiFunc(),delFunc(),modalCloseNone()}).catch(err=>alert(err)),console.log(bbs)});